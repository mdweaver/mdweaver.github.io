---
title: "Investigating Politics"
author: "Michael Weaver"
date: "March 28, 2018"
output: ioslides_presentation
df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
require(magrittr)
require(kableExtra)
require(knitr)
require(ggplot2)
require(gtools)
require(dagR)
require(data.table)
require(MASS)
```
<style>
.forceBreak { -webkit-column-break-after: always; break-after: column; }
h3, h4 {font-weight: bold;
        color: #515151;}
</style>

# From Correlation to Causality

### A summary

# The Problem

## What is the problem? {.build}

### Correlation as clue to Causality

If $X \rightarrow Y$:

- Values of $X$ and $Y$ should move together
- Values of $X$ and $Y$ should be correlated
- This correlation should not be **by chance**

### A hiccup:

It is possible that  $X,Y$ are correlated, without causation

## $W \rightarrow X$

| i | $Y_i^0$ | $Y_i^1$ | $Y_i^1 - Y_i^0$ | $X_i$ | $W_i$ |
|---|---------|--------|-----------------|--|--|
| 1 | 5 | 9 | 4 |$\mathbf{1}$|$\mathbf{1}$|
| 2 | 4 | 8 | 4 |$\mathbf{1}$|$\mathbf{1}$|
| 3 | 3 | 7 | 4 |$\mathbf{0}$|$\mathbf{0}$|
| 4 | 2 | 6 | 4 |$\mathbf{0}$|$\mathbf{0}$|


## $W \rightarrow Y$

| i | $Y_i^0$ | $Y_i^1$ | $Y_i^1 - Y_i^0$ | $X_i$ | $W_i$ |
|---|---------|--------|-----------------|--|--|
| 1 | $\mathbf{5}$ | $\mathbf{9}$ | 4 |1|$\mathbf{1}$|
| 2 | $\mathbf{4}$ | $\mathbf{8}$ | 4 |1|$\mathbf{1}$|
| 3 | $\mathbf{3}$ |  $\mathbf{7}$| 4 |0|$\mathbf{0}$|
| 4 | $\mathbf{2}$ | $\mathbf{6}$ | 4 |0|$\mathbf{0}$|


## What is the problem?

```{r, echo = F}
par(mfrow = c(1,1))
dag <- dag.init(y.name = "", x.name = "", 
        covs = c(1),
        arcs = c(1, 0, 1,-1),
        symbols = c('X','W','Y'))
invisible(dag.draw(add.arc(dag, arc = c(1,3), type = 1), legend = F, noxy=1))
text(mean(dag$x[1:2]), mean(dag$y[1:2]), "Causes\nIncrease", pos = 2)
text(mean(dag$x[2:3]), mean(dag$y[2:3]), "Causes\nIncrease", pos = 4)
text(dag$x[2], dag$y[1], "Spurious positive correlation!", pos = 1)

```

## Spurious Correlation:

**spurious correlation**: when the **observed** correlation between $X$ (independent variable) and $Y$ (dependent variable) inaccurately reflects the **true** causal relationship $X \rightarrow Y$

- Can think of this as a kind of **bias**:

$$Correlation_{True}(X,Y) - Correlation_{Observed}(X,Y) \neq 0$$

## Spurious Correlation:

**confounding variables** are the **source** of **spurious correlation**:

- Variables other than $X,Y$ (e.g. $W$), that are related to both $X$ and $Y$

## Spurious Correlation:

### Types:

1. **confounding variables** cause both $X,Y$ to appear correlated when $X$ **does not cause** $Y$


## Spurious Correlation: Truth

```{r, echo = F}
par(mfrow = c(1,1))
dag <- dag.init(y.name = "", x.name = "", 
        covs = c(1),
        arcs = c(1, 0, 1,-1),
        symbols = c('X','W','Y'))
invisible(dag.draw(dag, legend = F, noxy=1))
text(mean(dag$x[1:2]), mean(dag$y[1:2]), "Causes\nIncrease", pos = 2)
text(mean(dag$x[2:3]), mean(dag$y[2:3]), "Causes\nIncrease", pos = 4)
text(dag$x[2], dag$y[1], "No causation", pos = 1)
```

## Spurious Correlation: Observed

```{r, echo = F}
par(mfrow = c(1,1))
dag <- dag.init(y.name = "", x.name = "", 
        covs = c(1),
        arcs = c(1, 0, 1,-1),
        symbols = c('X','W','Y'))
invisible(dag.draw(add.arc(dag, arc = c(1,3), type = 1), legend = F, noxy=1))
text(mean(dag$x[1:2]), mean(dag$y[1:2]), "Causes\nIncrease", pos = 2)
text(mean(dag$x[2:3]), mean(dag$y[2:3]), "Causes\nIncrease", pos = 4)
text(dag$x[2], dag$y[1], "Spurious positive correlation!", pos = 1)
```

## Spurious Correlation:

### Types:

1. **confounding variables** cause both $X,Y$ to appear correlated when $X$ **does not cause** $Y$
2. **confounding variables** cause both $X,Y$ to appear **uncorrelated** when $X$ **does cause** $Y$


## Spurious Correlation: Truth

```{r, echo = F}
par(mfrow = c(1,1))
dag <- dag.init(y.name = "", x.name = "", 
        covs = c(1),
        arcs = c(1, 0, 1,-1),
        symbols = c('Peace\nKeeping','Intense\nViolence','Lasting\nPeace'),
        ygap = 0.1,
        xgap = 0.1)
invisible(dag.draw(add.arc(dag, arc = c(1,3), type = 0), legend = F, noxy=2))
text(mean(dag$x[1:2]), mean(dag$y[1:2]), "Causes\nIncrease", pos = 2)
text(mean(dag$x[2:3]), mean(dag$y[2:3]), "Causes\nDecrease", pos = 4)
text(dag$x[2], dag$y[1] - 0.1, "Causes Increase", pos = 1)
```


## Spurious Correlation: Observed

```{r, echo = F}
par(mfrow = c(1,1))
dag <- dag.init(y.name = "", x.name = "", 
        covs = c(1),
        arcs = c(1, 0, 1,-1),
        symbols = c('Peace\nKeeping','Intense\nViolence','Lasting\nPeace'),
        ygap = 0.1,
        xgap = 0.1)
invisible(dag.draw(add.arc(dag, arc = c(1,3), type = 1), legend = F, noxy=1))
text(mean(dag$x[1:2]), mean(dag$y[1:2]), "Causes\nIncrease", pos = 2)
text(mean(dag$x[2:3]), mean(dag$y[2:3]), "Causes\nDecrease", pos = 4)
#text(dag$x[2], dag$y[1] - 0.05, "Causes Increase", pos = 1)
text(dag$x[2], dag$y[1] , "Spurious Absence of Correlation", pos = 1)
```


## Spurious Correlation:

### Types:

1. **confounding variables** cause $X,Y$ to appear correlated when $X$ **does not cause** $Y$
2. **confounding variables** cause $X,Y$ to appear **uncorrelated** when $X$ **does cause** $Y$
3. **confounding variables** cause $X,Y$ relationship to be **too positive** or **too negative**
    - effect of $X \rightarrow Y$ appears **too strong** compared to **truth**
    - effect of $X \rightarrow Y$ appears **too weak** compared to **truth**
    - effect of $X \rightarrow Y$ appears **wrong direction** compared to **truth**

## Spurious Correlation: Truth

```{r, echo = F}
par(mfrow = c(1,1))
dag <- dag.init(y.name = "", x.name = "", 
        covs = c(1),
        arcs = c(1, 0, 1,-1),
        symbols = c('Cancer\nTherapy','Cancer\nDiagnosis','Life\nExpectancy'),
        ygap = 0.1,
        xgap = 0.1)
invisible(dag.draw(add.arc(dag, arc = c(1,3), type = 0), legend = F, noxy=2))
text(mean(dag$x[1:2]), mean(dag$y[1:2]), "Causes\nIncrease", pos = 2)
text(mean(dag$x[2:3]), mean(dag$y[2:3]), "Causes\nDecrease", pos = 4)
text(dag$x[2], dag$y[1] - 0.05, "Causes Increase", pos = 1)
#text(dag$x[2], dag$y[1] + 0.05, "Spurious Absence of Correlation", pos = 3)
```

## Spurious Correlation: Observed

```{r, echo = F}
par(mfrow = c(1,1))
dag <- dag.init(y.name = "", x.name = "", 
        covs = c(1),
        arcs = c(1, 0, 1,-1),
        symbols = c('Cancer\nTherapy','Cancer\nDiagnosis','Life\nExpectancy'),
        ygap = 0.1,
        xgap = 0.1)
invisible(dag.draw(add.arc(dag, arc = c(1,3), type = 1), legend = F, noxy=1))
text(mean(dag$x[1:2]), mean(dag$y[1:2]), "Causes\nIncrease", pos = 2)
text(mean(dag$x[2:3]), mean(dag$y[2:3]), "Causes\nDecrease", pos = 4)
#text(dag$x[2], dag$y[1] - 0.05, "Causes Increase", pos = 1)
text(dag$x[2], dag$y[1] + 0.05, "Spurious Negative Correlation", pos = 3)
```


## Spurious Correlation:

### Types:

1. **confounding variables** cause $X,Y$ to appear correlated when $X$ **does not cause** $Y$
2. **confounding variables** cause $X,Y$ to appear **uncorrelated** when $X$ **does cause** $Y$
3. **confounding variables** cause $X,Y$ relationship to be **too positive** or **too negative**
    - effect of $X \rightarrow Y$ appears **too strong** compared to **truth**
    - effect of $X \rightarrow Y$ appears **too weak** compared to **truth**
    - effect of $X \rightarrow Y$ appears **wrong direction** compared to **truth**

### Bias

All of these are examples of **bias**: true causal relationship of $X,Y$ not observed due to **confounding**

- **bias** implies absence of **internal validity** (recovering **true** causal relationship)

## Spurious Correlation:

### What you need to know:

1. What is confounding
2. What is spurious correlation/bias?
2. Why does it happen?
3. What are the different forms it can take
4. If we know **direction** of effects of $W$ on both $X,Y$, what is direction of **bias**/**spurious** relationship

# Solutions for Confounding

## What we need to know:

1. What are broad types of solutions?
    - Adjustment vs Design (Similar Cases, Same Case, Diff-in-Diff, Natural Experiments, Experiments)
2. For each broad type:
    - **How** does it remove confounding
    - **What confounding** does it eliminate/not eliminate
    - **What** are its key **assumptions** (to conclude **no remaining bias**/spurious correlation)
    - **What** is the **tradeoff** between **internal** and **external** validity

## Adjustment

1. **How it fixes confounding**: 
    - Holds confounding variables constant, can no longer induce spurious correlation
    - **conditioning** looks at correlation of $X,Y$ holding **confounding variables** constant
    
    
## Adjustment: No Conditioning

```{r, echo = F}
par(mfrow = c(1,1))
dag <- dag.init(y.name = "", x.name = "", 
        covs = c(1),
        arcs = c(1, 0, 1,-1),
        symbols = c('Peace\nKeeping','Intense\nViolence','Lasting\nPeace'),
        ygap = 0.1,
        xgap = 0.1)
invisible(dag.draw(add.arc(dag, arc = c(1,3), type = 1), legend = F, noxy=1))
text(mean(dag$x[1:2]), mean(dag$y[1:2]), "Causes\nIncrease", pos = 2)
text(mean(dag$x[2:3]), mean(dag$y[2:3]), "Causes\nDecrease", pos = 4)
#text(dag$x[2], dag$y[1] - 0.05, "Causes Increase", pos = 1)
text(dag$x[2], dag$y[1] , "Spurious Absence of Correlation", pos = 1)
```

## Adjustment: With Conditioning

```{r, echo = F}
par(mfrow = c(1,1))
dag <- dag.init(y.name = "", x.name = "", 
        covs = c(1),
        symbols = c('Peace\nKeeping','Intense\nViolence','Lasting\nPeace'),
        ygap = 0.1,
        xgap = 0.1)
invisible(dag.draw(dag, legend = F, noxy=2))
text(mean(dag$x[1:2]), mean(dag$y[1:2]), "No change", pos = 2)
text(mean(dag$x[2:3]), mean(dag$y[2:3]), "No change")
text(mean(dag$x[2]), mean(dag$y[2]) + 0.05, "Held Constant", pos = 3, font = 2)
#text(dag$x[2], dag$y[1] - 0.05, "Causes Increase", pos = 1)
text(dag$x[2], dag$y[1] , "True Correlation", pos = 1)
```


## Adjustment

* **How it fixes confounding**: 
    - Holds confounding variables constant, can no longer induce spurious correlation
    - **conditioning** looks at correlation of $X,Y$ holding **confounding variables** constant
* **What confounding is removed**:
    - Removes confounding from **all measured variables** used in **conditioning**
    - **Does not** remove confounding from **unmeasured**/**mis-measured** variables
* **Key Assumptions** (things to be argued for): 
    - Condition on **all** confounding variables 
    - No measurement error on confounding variables

## Adjustment: No Conditioning

```{r, echo = F}
par(mfrow = c(1,1))
dag <- dag.init(y.name = "", x.name = "", 
        covs = c(1,1),
        arcs = c(1, 0, 1,-1, 2, 0, 2, -1),
        symbols = c('Peace\nKeeping','Intense\nViolence', 'War\nLength','Lasting\nPeace'),
        ygap = 0.1,
        xgap = 0.1)
invisible(dag.draw(add.arc(dag, arc = c(1,4), type = 1), legend = F, noxy=1))
#text(mean(dag$x[1:2]), mean(dag$y[1:2]), "Causes\nIncrease", pos = 2)
#text(mean(dag$x[2:3]), mean(dag$y[2:3]), "Causes\nDecrease", pos = 4)
#text(dag$x[2], dag$y[1] - 0.05, "Causes Increase", pos = 1)
text(mean(dag$x[c(1,4)]), dag$y[1] , "Biased/Spurious Correlation", pos = 1)
```

## Adjustment: No Conditioning

```{r, echo = F}
par(mfrow = c(1,1))
dag <- dag.init(y.name = "", x.name = "", 
        covs = c(1,1),
        arcs = c(2, 0, 2, -1),
        symbols = c('Peace\nKeeping','Intense\nViolence', 'War\nLength','Lasting\nPeace'),
        ygap = 0.1,
        xgap = 0.1)
invisible(dag.draw(add.arc(dag, arc = rbind(c(1,4)), type = c(1)), legend = F, noxy=1))
#text(mean(dag$x[1:2]), mean(dag$y[1:2]), "Causes\nIncrease", pos = 2)
#text(mean(dag$x[2:3]), mean(dag$y[2:3]), "Causes\nDecrease", pos = 4)
#text(dag$x[2], dag$y[1] - 0.05, "Causes Increase", pos = 1)
text(mean(dag$x[2]), mean(dag$y[2]) + 0.05, "Held Constant", pos = 3, font = 2)
text(mean(dag$x[c(1,4)]), dag$y[1] , "Still Biased/Spurious Correlation", pos = 1)
```


## Adjustment

* **How it fixes confounding**: 
    - Holds confounding variables constant, can no longer induce spurious correlation
    - **conditioning** looks at correlation of $X,Y$ holding **confounding variables** constant
* **What confounding is removed**:
    - Removes confounding from **all measured variables** used in **conditioning**
    - Does not remove confounding from **unmeasured**/**mis-measured** variables

## Adjustment

* **Key Assumptions** (to conclude no remaining bias): 
    - Condition on **all** confounding variables 
    - No measurement error on confounding variables
* **Methods**:
    - Matching (compare cases with same values on confounding variables)
    - Regression (linear approximation of above)
* **Tradeoff**
    - Can be done for **all relevant** cases, **high external validity**
    - Requires big assumptions, **low internal validity**

## Design:

**design**-based solutions:

Choose comparison so that we eliminate possible **confounding** variables

- Hold **confounding** variable **constant** (like conditioning) 

#### **OR**

- Break link between confounding variable(s) $W$ and independent variable $X$
 
## Design: Similar Cases

Compare cases in same **place** and **time**

* **How it fixes confounding**: 
    - Holds confounding variables **constant**, can no longer induce spurious correlation
* **What confounding is removed**:
    - Removes confounding from **all measured/unmeasured variables** that are **the same** for compared cases
    - Does not account for **unchanging** variables that  **differ** between cases 
    - Does not account for **changing** variables that  **differ** between cases 
    
## Design: Similar Cases

```{r, echo = F}
par(mfrow = c(1,1))
dag <- dag.init(y.name = "", x.name = "", 
        covs = c(1,1,1),
        arcs = c(2, 0, 2, -1, 1,0,1,-1,3,0,3,-1),
        symbols = c('Racial\nBias','Shared\nContext\nSimil.', 'Unchanging\nIndividual\nDiffs','Changing\nIndividual\nDiffs', "Income"),
        ygap = 0.1,
        xgap = 0.1)
invisible(dag.draw(add.arc(dag, arc = c(1,5), type = 1), legend = F, noxy=1))
text(mean(dag$x[c(1,5)]), dag$y[1] , "Biased/Spurious Correlation", pos = 1)
```

## Design: Similar Cases

```{r, echo = F}
par(mfrow = c(1,1))
dag <- dag.init(y.name = "", x.name = "", 
        covs = c(1,1,1),
        symbols = c('Racial\nBias','Shared\nContext\nSimil.', 'Unchanging\nIndividual\nDiffs','Changing\nIndividual\nDiffs', "Income"),
        ygap = 0.1,
        xgap = 0.1)
invisible(dag.draw(add.arc(dag, arc = rbind(c(1,4),c(1,3),c(5,4),c(5,3)), type = rep(1,4)), legend = F, noxy=2))
#text(mean(dag$x[1:2]), mean(dag$y[1:2]), "Causes\nIncrease", pos = 2)
#text(mean(dag$x[2:3]), mean(dag$y[2:3]), "Causes\nDecrease", pos = 4)
#text(dag$x[2], dag$y[1] - 0.05, "Causes Increase", pos = 1)
text(mean(dag$x[2]), mean(dag$y[2]) + 0.1, "Held Constant", pos = 3, font = 2)
text(mean(dag$x[3]), mean(dag$y[3]) + 0.1, "NO", pos = 3, font = 2)
text(mean(dag$x[4]), mean(dag$y[4]) + 0.1, "NO", pos = 3, font = 2)

text(mean(dag$x[c(1,5)]), dag$y[1] , "True Correlation\n(given assumptions)", pos = 1)

```

## Design: Similar Cases

Compare cases in same **place** and **time** with different exposure to the cause

* **How it fixes confounding**: 
    - Holds confounding variables **constant**, can no longer induce spurious correlation
* **What confounding is removed**:
    - Removes confounding from **all measured/unmeasured variables** that are **the same** for compared cases
    - Does not account for **unchanging** variables that  **differ** between cases 
    - Does not account for **changing** variables that  **differ** between cases 

## Design: Similar Cases

* **Key Assumptions** (to conclude no remaining bias): 
    - No **constant**/**time-invariant** differences between cases that affect $X,Y$
    - No **changing**/**time-variant** differences between cases that affect $X,Y$
* **Methods**:
    - Finding cases close in time and space 
* **Tradeoff**
    - Very similar cases available for only **some** relevant cases, **lower external validity**
    - Requires fewer assumptions about confounding variables, **higher internal validity**

## Design: Same Case

Compare same case to itself over time

* **How it fixes confounding**: 
    - Holds confounding variables **constant**, can no longer induce spurious correlation
* **What confounding is removed**:
    - Removes confounding from **all measured/unmeasured variables** that are **unchanging** for the case
    - Does not remove confounding variables that **change** over time
    
## Design: Same Case

```{r, echo = F}
par(mfrow = c(1,1))
dag <- dag.init(y.name = "", x.name = "", 
        covs = c(1,1,1),
        arcs = c(2, 0, 2, -1, 1,0,1,-1,3,0,3,-1),
        symbols = c('NYPD\nLeadership','Shared\nChanging\nVars', 'NYC\nUnchanging\nVars','NYC\nChanging\nVars', "Racial\nProfiling"),
        ygap = 0.1,
        xgap = 0.1)
invisible(dag.draw(add.arc(dag, arc = c(1,5), type = 1), legend = F, noxy=1))
text(mean(dag$x[c(1,5)]), dag$y[1] , "Biased/Spurious Correlation", pos = 1)
```

## Design: Same Case

```{r, echo = F}
par(mfrow = c(1,1))
dag <- dag.init(y.name = "", x.name = "", 
        covs = c(1,1,1),
        #arcs = c(2, 0, 2, -1, 1,0,1,-1,3,0,3,-1),
        symbols = c('NYPD\nLeadership','Shared\nChanging\nVars', 'NYC\nUnchanging\nVars','NYC\nChanging\nVars', "Racial\nProfiling"),
        ygap = 0.1,
        xgap = 0.1)
invisible(dag.draw(add.arc(dag, arc = rbind(c(1,2),c(1,4),c(5,4),c(5,2)), type = rep(1,4)), legend = F, noxy=2))
text(mean(dag$x[2]), mean(dag$y[2]) + 0.1, "NO", pos = 3, font = 2)
text(mean(dag$x[3]), mean(dag$y[3]) + 0.1, "Held Constant", pos = 3, font = 2)
text(mean(dag$x[4]), mean(dag$y[4]) + 0.1, "NO", pos = 3, font = 2)

text(mean(dag$x[c(1,5)]), dag$y[1] , "True Correlation\n(given assumptions)", pos = 1)
```


## Design: Same Case

Compare same case to itself over time

* **How it fixes confounding**: 
    - Holds confounding variables **constant**, can no longer induce spurious correlation
* **What confounding is removed**:
    - Removes confounding from **all measured/unmeasured variables** that are **unchanging** for the case
    - Does not remove confounding variables that **change** over time
        
## Design: Same Case

* **Key Assumptions** (to conclude no remaining bias): 
    - No confounding variables that **change over time** for *this* case
    - No confounding variables that **change over time** for *all* cases
* **Methods**:
    - "interrupted time series"
* **Tradeoff**
    - Result for individual case may not to all relevant cases, **lower external validity**
    - Requires fewer assumptions about confounding variables, **higher internal validity**
    
## Design: Diff-in-Diff

Compare same case to itself over time against another case to itself

* **How it fixes confounding**: 
    - Holds confounding variables **constant**, can no longer induce spurious correlation
* **What confounding is removed**:
    - Removes confounding from **all measured/unmeasured variables** that are 
        - **unchanging** for each case
        - **changing** over time and shared by **all cases** (shared trend)
    - Does not remove confounding variables that **change** over time but **differ** across cases (case-specific trend)
    

## Design: Diff-in-Diff

```{r, echo = F}
par(mfrow = c(1,1))
dag <- dag.init(y.name = "", x.name = "", 
        covs = c(1,1,1),
        arcs = c(2, 0, 2, -1, 1,0,1,-1,3,0,3,-1),
        symbols = c('Minimum\nWage','Shared\nChanging\nVars', 'Case-Specific\nUnchanging\nVars','Case-Specific\nChanging\nVars', "Unemployment"),
        ygap = 0.1,
        xgap = 0.1)
invisible(dag.draw(add.arc(dag, arc = c(1,5), type = 1), legend = F, noxy=1))
text(mean(dag$x[c(1,5)]), dag$y[1] , "Biased/Spurious Correlation", pos = 1)
```

## Design: Diff-in-Diff

```{r, echo = F}
par(mfrow = c(1,1))
dag <- dag.init(y.name = "", x.name = "", 
        covs = c(1,1,1),
        #arcs = c(2, 0, 2, -1, 1,0,1,-1,3,0,3,-1),
        symbols = c('Minimum\nWage','Shared\nChanging\nVars', 'Case-Specific\nUnchanging\nVars','Case-Specific\nChanging\nVars', "Unemployment"),
        ygap = 0.1,
        xgap = 0.1)
invisible(dag.draw(add.arc(dag, arc = rbind(c(1,4),c(5,4)), type = rep(1,2)), legend = F, noxy=2))
text(mean(dag$x[2]), mean(dag$y[2]) + 0.1, "Held Constant", pos = 3, font = 2)
text(mean(dag$x[3]), mean(dag$y[3]) + 0.1, "Held Constant", pos = 3, font = 2)
text(mean(dag$x[4]), mean(dag$y[4]) + 0.1, "NO", pos = 3, font = 2)

text(mean(dag$x[c(1,5)]), dag$y[1] , "True Correlation\n(given assumptions)", pos = 1)
```

## Design: Diff-in-Diff

Compare same case to itself over time against another case to itself

* **How it fixes confounding**: 
    - Holds confounding variables **constant**, can no longer induce spurious correlation
* **What confounding is removed**:
    - Removes confounding from **all measured/unmeasured variables** that are 
        - **unchanging** for each case
        - **changing** over time and shared by **all cases** (shared trend)
    - Does not remove confounding variables that **change** over time but **differ** across cases (case-specific trends)

## Design: Diff-in-Diff

* **Key Assumptions** (to conclude no remaining bias): 
    - No confounding variables that change over time **differently** across cases (no differences in trends)
    - Conversely: assume trends are parallel (the same) across cases in absence of the cause (counterfactually)
* **Methods**:
    - check pre-cause parallel trends
    - "synthetic control" artificially produces (rather than assume) parallel trends
* **Tradeoff**
    - Cases with similar trends, but different "treatments" may be rare, **lower external validity**
    - Requires even fewer assumptions about confounding variables, **higher internal validity**
 
## Design: Natural Experiments

Compare cases where cause/independent variable/$X$ is (as-if) randomly assigned by "nature"

* **How it fixes confounding**: 
    - Breaks link between confounding variables $W,Z,\ldots$ and the independent variable $X$
* **What confounding is removed**:
    - Removes confounding from **all measured/unmeasured variables**
    
## Design: Natural Experiments

```{r, echo = F}
par(mfrow = c(1,1))
dag <- dag.init(y.name = "", x.name = "", 
        covs = c(1,1,1),
        arcs = c(2, 0, 2, -1, 1,0,1,-1,3,0,3,-1),
        symbols = c('Water\nSupply','Shared\nChanging\nVars', 'Person-Specific\nUnchanging\nVars','Person-Specific\nChanging\nVars', "Cholera"),
        ygap = 0.1,
        xgap = 0.1)
invisible(dag.draw(add.arc(dag, arc = c(1,5), type = 1), legend = F, noxy=1))
text(mean(dag$x[c(1,5)]), dag$y[1] , "Biased/Spurious Correlation", pos = 1)

```

## Design: Natural Experiments

```{r, echo = F}
par(mfrow = c(1,1))
dag <- dag.init(y.name = "", x.name = "", 
        covs = c(1,1,1),
        arcs = c( 2, -1, 1,-1,3,-1),
        symbols = c('Water\nSupply','Shared\nChanging\nVars', 'Person-Specific\nUnchanging\nVars','Person-Specific\nChanging\nVars', "Cholera"),
        ygap = 0.1,
        xgap = 0.1)
invisible(dag.draw(dag, legend = F, noxy=2))
text(mean(dag$x[c(1,5)]), dag$y[1] , "True Correlation\n(given randomness)", pos = 1)
text(mean(dag$x[1]), mean(dag$y[1])-0.1, "Randomly\nInduced", pos = 1, font = 2)

```


## Design: Natural Experiments

Compare cases where cause/independent variable/$X$ is (as-if) randomly assigned by "nature"

* **How it fixes confounding**: 
    - Breaks link between confounding variables $W,Z,\ldots$ and the independent variable $X$
* **What confounding is removed**:
    - Removes confounding from **all measured/unmeasured variables**
    
## Design: Natural Experiments

* **Key Assumptions** (to conclude no remaining bias): 
    - Cause is random (cases either unmotivated to, unable to, or unaware of selecting "treatment")
* **Methods**:
    - **standard natural experiment**
    - **regression discontinuity**
    - **instrumental variables**
* **Tradeoff**
    - cases with randomized cause unusual/rare; **low external validity**
    - Requires minimal assumptions about confounding variables, **high internal validity**


# Summary:

----

|  | How Bias<br>Solved | Which Bias<br>Removed | Assumes | Internal<br>Validity | External<br>Validity |
|--------------------|------------------------------|------------------------------------------------|---------|----------------------|----------------------|
| Adjustment | Hold <br>constant | All **measured**<br>confounding variables | Condition all<br>confounders | Lowest | Highest |
| Similar Cases | Hold <br>constant | Cases' **shared**<br>confounding variables | **No** diff.<br>b/t cases | Middle | Middle |
| Same Case | Hold <br>constant | Case's **unchanging**<br>confounding variables | **No** confounding<br>trends | Middle | Middle |
| Diff in Diff | Hold <br>constant | Case's **unchanging** variables <br> Cases' **shared** trends | Cases have <br> parallel trends | Higher | Lower |
| Natural Experiment | Break $W \rightarrow X$ link | **All** confounding variables | $X$ as-if random | Highest | Lowest |


