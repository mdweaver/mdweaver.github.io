---
title: "Investigating Politics"
author: "Michael Weaver"
date: "March 19, 2018"
output: ioslides_presentation
df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
require(magrittr)
require(kableExtra)
require(knitr)
require(ggplot2)
require(gtools)
require(dagR)
require(data.table)
require(MASS)
```
<style>
.forceBreak { -webkit-column-break-after: always; break-after: column; }
h3, h4 {font-weight: bold;
        color: #515151;}
</style>



# Midterm Grades

## Midterm scaling:

$$ScaledPoints = (MidtermPoints - 27.4) \cdot 0.715 + 32.6$$
Original Average: $59.9$%
New Average: $70.9$%

## Homework Scaling:

This week

# From Correlation to Causality

## What is the problem? {.build}

### Correlation as clue to Causality

If $X \rightarrow Y$:

- Values of $X$ and $Y$ should move together
- Values of $X$ and $Y$ should be correlated
- This correlation should not be **by chance**

### A hiccup:

It is possible that  $X,Y$ are correlated, without causation


## What is the problem?

| i | $Y_i^0$ | $Y_i^1$ | $Y_i^1 - Y_i^0$ | $X_i$ | $W_i$ |
|---|---------|--------|-----------------|--|--|
| 1 | 5 | 9 | 4 |1|**1**|
| 2 | 4 | 8 | 4 |1|**1**|
| 3 | 3 | 7 | 4 |0|**0**|
| 4 | 2 | 6 | 4 |0|**0**|

## What is the problem?

True causal effect of $X$: $4$.

Apparent causal effect of $X$: 

$$\frac{9+8}{2} - \frac{3+2}{2} = \frac{12}{2} \neq 4$$

### Why?


## What is the problem?

| i | $Y_i^0$ | $Y_i^1$ | $Y_i^1 - Y_i^0$ | $X_i$ | $W_i$ |
|---|---------|--------|-----------------|--|--|
| 1 | 5 | 9 | 4 |1|**1**|
| 2 | 4 | 8 | 4 |1|**1**|
| 3 | 3 | 7 | 4 |0|**0**|
| 4 | 2 | 6 | 4 |0|**0**|

## What is the problem?

### $W$ is related to $X$ and $Y$

1. $X = 0$ when $W = 0$. $X = 1$ when $W = 1$
    - perfect correlation
2. $Y \approx 4.5$ when $W = 0$. $Y \approx 6.5$ when $W = 1$
    - partial correlation
  
### $X$ causes $Y$...

but $W$ makes effect of $X$ look too big
    
## What is the problem?

```{r, echo = F}
x = rep(0:1, each = 4)
w = rep(0:1, each = 4)
y = c(2,3,7,6,5,4,8,9)
par(mfrow = c(1,2))
plot(w,x)
abline(lm(x~w))
text(0.5,0.2, paste0("Correlation: ", round(cor(w,x),2)))
plot(w,y)
abline(lm(y~w))
text(0.5,3, paste0("Correlation: ", round(cor(w,y),2)))

```


## What is the problem?

```{r, echo = F}
par(mfrow = c(1,1))
dag <- dag.init(y.name = "", x.name = "", 
        covs = c(1),
        arcs = c(1, 0, 1,-1),
        symbols = c('X','W','Y'))
invisible(dag.draw(add.arc(dag, arc = c(1,3), type = 1), legend = F, noxy=2))
text(mean(dag$x[1:2]), mean(dag$y[1:2]), "Causes\nIncrease", pos = 2)
text(mean(dag$x[2:3]), mean(dag$y[2:3]), "Causes\nIncrease", pos = 4)
text(dag$x[2], dag$y[1], "Effect is biased upward!", pos = 1)

```

## What is the problem?

### Is peace keeping effective?

```{r, echo = F}
par(mfrow = c(1,1))
dag <- dag.init(y.name = "", x.name = "", 
        covs = c(1),
        arcs = c(1, 0, 1,-1),
        symbols = c('Peace\nKeeping','Intense\nViolence','Conflict\nResolved'))
invisible(dag.draw(add.arc(dag, arc = c(1,3), type = 1), legend = F, noxy=2))
text(mean(dag$x[1:2]), mean(dag$y[1:2]), "Causes\nIncrease", pos = 2)
text(mean(dag$x[2:3]), mean(dag$y[2:3]), "Causes\nDecrease", pos = 4)
text(dag$x[2], dag$y[1], "Effect is biased downward!", pos = 1)

```

## What is the problem?

### Restatement:

We observe $X,Y$ correlated...

- ... but additional factors $W_1 \ldots W_n$ affect $X$ and $Y$
- So correlation is biased.
    - Could be entirely spurious (no true causal effect of $X$ on $Y$)
    - Or different from true effect of $X$. Observed effect too big/too small


## What can we do?

### Recall...

**Comparative Method:**

If causal claim that $X \rightarrow Y$, then:

We generate **empirical prediction**:

> If we observe **two cases** to be the same in all relevant respects except for value of $X$, then we should observe that the two cases differ in the value of $Y$

1. We don't need cases to be **identical** on **all** attributes
2. They need to be the **identical** on attributes related to both **cause** ($X$) and **outcome** ($Y$)
    - In short: identical on factors that affect $Y$ and are related to or affect $X$

## What can we do?

What does comparative method do?

1. Examines whether $Y$ changes when $X$ changes
2. Within pairs of cases where **confounding** variables held constant

### Can we generalize this?

**Comparative method**

- Can address **confounding**
- *But* works with only a few cases, patterns by chance?

**Correlation**

- Correlation uses many cases, can judge statistical significance
- *But* does not address **confounding**/bias

## Solutions

Two approaches to make correlation work like the comparative method

1. **adjustment**-based
    - Identify possible **confounding** variables (e.g. $W$)
    - Measure these variables
    - explicitly **adjust** our correlation between $X$ and $Y$, **accounting** for confounding variables
    - "**conditioning**" on confounding variables
2. **design**-based
    - Carefully choose **cases** for comparison
    - **Structure of comparison** accounts for many or **all** confounding variables
    - Kind of comparison permits **unconditional** comparison, given assumptions.


## Solutions: Examples

### Design-based: 

An experiment is **design**-based solution:

- We **compare** a "treated" group to an "untreated" group 
- We test using **unadjusted** correlation of treatment and outcome in these groups
- We have **good reason** to believe that correlation implies causation:
    - Not because we **explicitly** identified and accounted for **confounding** variables
    - Because **design** (random assignment of treatment) eliminates confounding

## Solutions: Experiment

```{r, echo = F}
par(mfrow = c(1,2))
dag <- dag.init(y.name = "", x.name = "", 
        covs = c(1),
        arcs = c(1, 0, 1,-1),
        symbols = c('Peace\nKeeping','Intense\nViolence','Conflict\nResolved'))
invisible(dag.draw(add.arc(dag, arc = c(1,3), type = 1), legend = F, noxy=2))
text(mean(dag$x[1:2]), mean(dag$y[1:2]), "Causes\nIncrease", pos = 2)
text(mean(dag$x[2:3]), mean(dag$y[2:3]), "Causes\nDecrease", pos = 4)
text(dag$x[2], dag$y[1], "Effect is biased downward!", pos = 1)

dag <- dag.init(y.name = "", x.name = "", 
        covs = c(1),
        arcs = c(1,-1),
        symbols = c('Peace\nKeeping','Intense\nViolence','Conflict\nResolved'))
invisible(dag.draw(dag, legend = F, noxy=2))
```

## Solutions: Examples

### Adjustment-based: 

This extrapolates **comparative method** to correlation.

The goal is to:

1. observe **confounding variables**
2. examine the correlation of $X$ and $Y$...
3. holding confounding variables **constant**
    - *ceteris parabis*, "all else being equal"

**conditioning**: the process of holding other variables constant while looking at relationship between $X$ and $Y$.


## Solutions: Examples

How to think about **adjustment**/**conditioning**:

It is **like**:

- **many** applications of comparative method simultaneously
- correlation of $X$ and $Y$ within groups where $X$ and $Y$ are held constant


It is not this **EXACTLY**


## Conditioning: Example

### Question

Does UN peace-keeping prevent re-occurrence of civil war?

### Causal Theory:

**Exposure** to UN **peace-keeping** at the end of a conflict causes countries to experience **longer periods** of **peace**

### Test?

Correlation is insufficient. Many variables may cause UN intervention AND ability to have durable peace

- Intensity of conflict (Deaths), Length of conflict, ethnic diversity, population, mountainous terrain, size of armed forces, democracy

## Conditioning: Example

### Test?

```{r, echo = F}
par(mfrow = c(1,1))
dag <- dag.init(y.name = "", x.name = "", 
        covs = c(1,1,1,1,1,1),
        arcs = c(1, 0, 1,-1,
                 2, 0, 2,-1,
                 3, 0, 3,-1,
                 4, 0, 4,-1,
                 5, 0, 5,-1,
                 6, 0, 6,-1),
        symbols = c('Peace\nKeeping',
                    'Intense\nViolence', "War Length", "Diversity", "Terrain", "Army Size", "Democracy",
                    'Durable\nPeace'))
invisible(dag.draw(dag, legend = F, noxy=2))
```

## Conditioning: Example

### Test

Look at correlation between Peacekeeping and Peace **within** groups of cases that have **same values** of:

- Violence, War length, Diversity, Terrain, Army Size, Democracy

**DOES NOT** eliminate the causal link between confounding variables and **peacekeeping** by design. We **adjust** our correlation to account for confounders.

----

Example (1)

|  | $Peace_i^{UN}$ | $Peace_i^{noUN}$ | $UN_i$ | $WarIntense_i$ | $Peace_i^{Obs}$ | $Effect_i$ |
|-----------|---------|---------|-------|-------|-------|----------|
| treated | 20 | 10 | 1 | 0 | $\mathbf{20}$ | 10 |
| treated | 20 | 10 | 1 | 0 | $\mathbf{20}$ | 10 |
| treated | 15 | 5 | 1 | 1 | $\mathbf{15}$ | 10 |
| untreated | 20 | 10 | 0 | 0 | $\mathbf{10}$ | 10 |
| untreated | 15 | 5 | 0 | 1 | $\mathbf{5}$ | 10 |
| untreated | 15 | 5 | 0 | 1 | $\mathbf{5}$ | 10 |

## Conditioning: Example

What is the **true** effect of peace-keeping?

$$\frac{10 + 10 + 10 + 10 + 10 + 10}{6} = 10$$

$10$ years more peace.

What is the effect we see with **unadjusted** or **unconditional** correlation?

(Average in peacekeeping - Average in no-peacekeeping)

----

Example (1)

|  | $Peace_i^{UN}$ | $Peace_i^{noUN}$ | $UN_i$ | $WarIntense_i$ | $Peace_i^{Obs}$ | $Effect_i$ |
|-----------|---------|---------|-------|-------|-------|----------|
| treated | 20 | 10 | 1 | 0 | $\mathbf{20}$ | 10 |
| treated | 20 | 10 | 1 | 0 | $\mathbf{20}$ | 10 |
| treated | 15 | 5 | 1 | 1 | $\mathbf{15}$ | 10 |
| untreated | 20 | 10 | 0 | 0 | $\mathbf{10}$ | 10 |
| untreated | 15 | 5 | 0 | 1 | $\mathbf{5}$ | 10 |
| untreated | 15 | 5 | 0 | 1 | $\mathbf{5}$ | 10 |

## Conditioning: Example

$$\frac{20 + 20 + 15}{3} - \frac{10 + 5 + 5}{3} = \frac{35}{3} \neq 10$$

We have upward **bias**: it looks like peace-keeping causes more peace than it does

### WHY?

---- 

|  | $Peace_i^{UN}$ | $Peace_i^{noUN}$ | $UN_i$ | $WarIntense_i$ | $Peace_i^{Obs}$ | $Effect_i$ |
|-----------|---------|---------|-------|-------|-------|----------|
| treated | 20 | 10 | $\mathbf{1}$ | $\mathbf{0}$ | 20 | 10 |
| treated | 20 | 10 | $\mathbf{1}$ | $\mathbf{0}$ | 20 | 10 |
| treated | 15 | 5 | 1 | 1 | 15 | 10 |
| untreated | 20 | 10 | $\mathbf{0}$ | $\mathbf{0}$ | 10 | 10 |
| untreated | 15 | 5 | 0 | 1 | 5 | 10 |
| untreated | 15 | 5 | 0 | 1 | 5 | 10 |

---- 

|  | $Peace_i^{UN}$ | $Peace_i^{noUN}$ | $UN_i$ | $WarIntense_i$ | $Peace_i^{Obs}$ | $Effect_i$ |
|-----------|---------|---------|-------|-------|-------|----------|
| treated | $\mathbf{20}$ | $\mathbf{10}$ | 1 | $\mathbf{0}$ | 20 | 10 |
| treated | $\mathbf{20}$ | $\mathbf{10}$ | 1 | $\mathbf{0}$ | 20 | 10 |
| treated | 15 | 5 | 1 | 1 | 15 | 10 |
| untreated | $\mathbf{20}$ | $\mathbf{10}$ | 0 | $\mathbf{0}$ | 10 | 10 |
| untreated | 15 | 5 | 0 | 1 | 5 | 10 |
| untreated | 15 | 5 | 0 | 1 | 5 | 10 |

## Conditioning: Example

### Unadjusted correlation BIASED because...

1. Intense wars $\xrightarrow{reduces}$ Peacekeeping
2. Intense wars $\xrightarrow{reduces}$ Durable Peace

Result?

>- Upward bias in effect of peacekeeping on durable peace

### Solution:

Conditioning! Calculate effect of peacekeeping where Intense War is $1$

----

|  | $Peace_i^{UN}$ | $Peace_i^{noUN}$ | $UN_i$ | $WarIntense_i$ | $Peace_i^{Obs}$ | $Effect_i$ |
|-----------|---------|---------|-------|-------|-------|----------|
| treated | 20 | 10 | 1 | 0 | 20 | 10 |
| treated | 20 | 10 | 1 | 0 | 20 | 10 |
| treated |  $\mathbf{15}$  |  $\mathbf{5}$  |  $\mathbf{1}$ | 1 | $\mathbf{15}$ | 10 |
| untreated | 20 | 10 | 0 | 0 | 10 | 10 |
| untreated |  $\mathbf{15}$  |  $\mathbf{5}$  | $\mathbf{0}$ | 1 | $\mathbf{5}$ | 10 |
| untreated |  $\mathbf{15}$  |  $\mathbf{5}$  | $\mathbf{0}$ | 1 | $\mathbf{5}$ | 10 |

## Conditioning: Examples

Effect of peacekeeping where war intensity is high (1):

$$\frac{15}{1} - \frac{5 + 5}{2} = \frac{10}{1} = 10$$


... and where war intensity is low (0)?

----

|  | $Peace_i^{UN}$ | $Peace_i^{noUN}$ | $UN_i$ | $WarIntense_i$ | $Peace_i^{Obs}$ | $Effect_i$ |
|-----------|---------|---------|-------|-------|-------|----------|
| treated | $\mathbf{20}$ | $\mathbf{10}$ | $\mathbf{1}$ | 0 | $\mathbf{20}$ | 10 |
| treated | $\mathbf{20}$ | $\mathbf{10}$ | $\mathbf{1}$ | 0 | $\mathbf{20}$ | 10 |
| treated | 15 | 5 | 1 | 1 | 15 | 10 |
| untreated | $\mathbf{20}$ | $\mathbf{10}$ | $\mathbf{0}$ | 0 | $\mathbf{10}$ | 10 |
| untreated | 15 | 5 | 0 | 1 | 5 | 10 |
| untreated | 15 | 5 | 0 | 1 | 5 | 10 |

## Conditioning: Examples

Effect of peacekeeping where war intensity is low (0):

$$\frac{20 + 20}{2} - \frac{10}{1} = \frac{10}{1} = 10$$

## Conditioning: Examples

Within the groups of cases defined by values of war intensity:

- Estimated effect of peacekeeping (compare cases with to without) retrieves the **true** effect
- **Conditioning** solved our problem of bias

Why does this work?

1. Within groups of cases with same values on confounder (war intensity ...
2. Potential outcomes (years of peace) with and without UN peacekeepers are **same** for "treated" and "untreated"
3. Same as: no other factor affects **both** UN peacekeeping ($X$) and peace ($Y$)

----

|  | $Peace_i^{UN}$ | $Peace_i^{noUN}$ | $UN_i$ | $WarIntense_i$ | $Peace_i^{Obs}$ | $Effect_i$ |
|-----------|---------|---------|-------|-------|-------|----------|
| treated | $\mathbf{20}$ | $\mathbf{10}$ | $\mathbf{1}$ | 0 | 20 | 10 |
| treated | $\mathbf{20}$ | $\mathbf{10}$ | $\mathbf{1}$ | 0 | 20 | 10 |
| treated | 15 | 5 | 1 | 1 | 15 | 10 |
| untreated | $\mathbf{20}$ | $\mathbf{10}$ | $\mathbf{0}$ | 0 | 10 | 10 |
| untreated | 15 | 5 | 0 | 1 | 5 | 10 |
| untreated | 15 | 5 | 0 | 1 | 5 | 10 |

----

|  | $Peace_i^{UN}$ | $Peace_i^{noUN}$ | $UN_i$ | $WarIntense_i$ | $Peace_i^{Obs}$ | $Effect_i$ |
|-----------|---------|---------|-------|-------|-------|----------|
| treated | 20 | 10 | 1 | 0 | 20 | 10 |
| treated | 20 | 10 | 1 | 0 | 20 | 10 |
| treated |  $\mathbf{15}$  |  $\mathbf{5}$  |  $\mathbf{1}$ | 1 | 15 | 10 |
| untreated | 20 | 10 | 0 | 0 | 10 | 10 |
| untreated |  $\mathbf{15}$  |  $\mathbf{5}$  | $\mathbf{0}$ | 1 | 5 | 10 |
| untreated |  $\mathbf{15}$  |  $\mathbf{5}$  | $\mathbf{0}$ | 1 | 5 | 10 |


## Conditioning in Action:

### Peace-keeping and peace

(Gilligan & Sergenti 2008)

Look at correlation of peacekeeping and peace after conflict:

- Matching countries on: intensity of conflict (Deaths), length of conflict, ethnic diversity, population, mountainous terrain, size of armed forces, democracy

### Is there an effect after conditioning?

## Conditioning in Action:

<img src="./peacekeeping.png" width=70%>

(Lower proportional hazards => war less likely)

## Conditioning in Action:

(Gilligan & Sergenti 2008)

**Conditioning** on other factors (holding them constant):

Peacekeeping makes war 85% less likely to re-emerge

## Conditioning in Action:

### Causal Claim

The presence of guns causes an increase in violent crame

### Causal Theory:

The **firearm ownership rate** causes an increase in the **violent crime rate**


## Conditioning in Action:

### Test

<img src="./gun_violence.jpg" width=100%>

## Conditioning in Action:

### Test

Correlation between gun ownership and homicides is nearly $0$.

>- Does this mean no causal relationship?
>- Lots of possible sources of bias.

## Conditioning in Action:

### (Moore and Bergner 2016)

- Look at US counties
- Use "regression" to adjust correlation between guns and violent crime
- Adjust for possible confounders:
    - Region, urban/rural, population, poverty, ethnic diversity, unemployment, gender, poverty
    - "Holding these factors constant", "ceteris parabis"

## Conditioning in Action:

<img src="./guns_table.png" width=60%>


## Regression Tables:

1. **Dependent Variables**: column names (usually)
2. **Independent Variable**(s): row names (usually)
    - Includes our causal variable, and possible **confounding** variables
3. **effect size**: Number not in parentheses
    - This is a slope for variable: $Y = \mathbf{m} \cdot X + b$
    - How much $Y$ changes with one unit change in $X$
    - Change in $Y$ with change in $X$, **holding other variables constant**
4. Stars and (): uncertainty
    - Stars indicate $p$ values

## Regression Tables:

Buyer beware. Unless stated otherwise...

### ASSUMES LINEARITY IN ALL RELATIONSHIPS

## Conditioning in Action:

<img src="./guns_table.png" width=60%>
    
## Conditioning in Action:
    
### (Moore and Bergner 2016)

Holding county-attributes constant:

- Increased firearm presence **increases** violent crime

Unadjusted correlation between guns and homicide: **biased downward**


<!-- ## Adjustment -->

<!-- Limitations: -->

<!-- 1. Typically only so many variables we can condition on: -->
<!--     - mathematically constrained -->
<!--     - just like comparative method, can't find similar cases -->
<!--     - could prevent us from conditioning on all sources of bias -->
<!-- 2. We must **know** and **measure correctly** all variables that produce bias. -->
<!--     - Otherwise, adjustment/conditioning does not work -->